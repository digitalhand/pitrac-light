@startuml
title PiTrac Architecture (Services + Runtime Components)

skinparam shadowing false
skinparam backgroundColor white
skinparam componentStyle rectangle
skinparam packageStyle rectangle
skinparam defaultTextAlignment center

actor "User" as user

node "Raspberry Pi OS (arm64)" as pi {
  package "systemd Services" {
    [activemq.service] as amqsvc
  }

  package "CLI / Operations Layer" as cli {
    [pitrac-cli (Go)\nenv, config, run,\nbuild, doctor, service] as pitrac_cli
    [RunScripts (Bash)\nrunCam1.sh, runCam2.sh,\ncalibration scripts] as runscripts
  }

  package "Core LM Runtime (C++ pitrac_lm)" as lm {
    [Camera1 Process\nFSM + hit detection\n+ ball analysis] as cam1
    [Camera2 Process\ncapture / IPC responder] as cam2
    [IPC System\n(OpenWire producer/consumer)] as ipc
    [Simulator Interfaces\nGSPro TCP sockets] as simsock
    [GsUISystem\nstatus + image logging] as uisys
  }

  database "ActiveMQ Broker\nOpenWire :61616" as amq

  folder "golf_sim_config.json\n+ PITRAC_* env vars" as cfgfiles
  folder "~/LM_Shares/Images\n(shot + debug images)" as images
}

cloud "Simulator PC" as simpc {
  [GSPro] as gspro
}

user --> pitrac_cli : pitrac-cli run / config / doctor
user --> runscripts : source + execute scripts

amqsvc --> amq : broker runtime

pitrac_cli --> cfgfiles : read/write config
pitrac_cli --> cam1 : spawn process
pitrac_cli --> cam2 : spawn process
runscripts --> cfgfiles : load env + config
runscripts --> cam1 : spawn process
runscripts --> cam2 : spawn process

cam1 --> ipc
cam2 --> ipc
ipc --> amq : topic Golf.Sim

cam1 --> simsock
simsock --> gspro : TCP :921

cam1 --> uisys
cam2 --> uisys
uisys --> amq : IPC status/results messages
uisys --> images : shot/debug/calibration images

@enduml
