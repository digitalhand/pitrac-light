@startuml
title PiTrac Data Flow (Config, Runtime, Simulator)

skinparam shadowing false
skinparam backgroundColor white
skinparam sequenceMessageAlign center
skinparam responseMessageBelowArrow true

actor Operator
participant "pitrac-cli" as CLI
participant "~/.pitrac/config\n(JSON + env)" as CFG
participant "ActiveMQ Broker\nGolf.Sim topic" as MQ
participant "pitrac_lm camera1" as CAM1
participant "pitrac_lm camera2" as CAM2
participant "GSPro Interface\n(sim/common + sim/gspro)" as SIM
participant "GSPro" as GSPRO
participant "Image + log directories" as FILES

== Configuration ==
Operator -> CLI : env setup / config init / config args
CLI -> CFG : write pitrac.env\ncopy golf_sim_config.json

== Runtime Start ==
Operator -> CLI : service start (or run cam)
CLI -> MQ : ensure broker reachable
CLI -> CAM2 : optional start first
CLI -> CAM1 : start camera1 runtime
CAM1 -> CFG : load config + overrides
CAM2 -> CFG : load config + overrides

== Ball-Hit Processing ==
CAM1 -> MQ : IPC kRequestForCamera2Image
CAM1 -> FILES : write status/debug images
CAM2 -> MQ : IPC kCamera2Image
CAM1 -> CAM1 : process image + compute metrics
CAM1 -> SIM : SendResultsToGolfSims()
SIM -> GSPRO : TCP JSON :921
CAM1 -> MQ : IPC kResults / status / errors
CAM1 -> FILES : write result artifacts
CAM2 -> FILES : write capture artifacts

== Calibration Path ==
Operator -> CLI : run auto-calibrate --camera N
CLI -> CAM1 : launch cameraNAutoCalibrate mode
CAM1 -> CFG : backup + write updated focal length/angles

@enduml
