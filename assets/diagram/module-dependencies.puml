@startuml
skinparam componentStyle rectangle
skinparam backgroundColor white
skinparam defaultTextAlignment center

title PiTrac-Light Module Dependencies (Refactored)

package "Entrypoints" #EEEEEE {
  component [pitrac-cli\n(Go)] as cli #E5F5FF
  component [RunScripts\n(Bash)] as scripts #E5F5FF
  component [pitrac_lm\n(lm_main.cpp)] as lm #E5F5FF
}

package "Meson Runtime Libraries" #EEEEEE {
  component [core] as core #FFE5E5
  component [vision\n(ball/image processing)] as vision #FFE5E5
  component [sim/common] as sim_common #FFFFD0
  component [sim/gspro] as sim_gspro #FFFFD0
  component [utils] as utils #E5F5E5
}

package "Camera Pipeline Modules" #EEEEEE {
  component [encoder] as encoder #FFF2E5
  component [image] as image #FFF2E5
  component [output] as output #FFF2E5
  component [preview] as preview #FFF2E5
  component [post_processing_stages] as post #FFF2E5
}

package "Bounded Contexts (Standalone CMake)" #EEEEEE {
  component [Camera] as camera_bc #F5E5FF
  component [ImageAnalysis] as image_bc #F5E5FF
}

package "Verification" #EEEEEE {
  component [src/tests\n(Boost.Test / CTest)] as tests #F0F0F0
}

cli ..> lm : launches modes\nand service workflows
scripts ..> lm : direct execution

lm --> core
lm --> vision
lm --> sim_common
lm --> sim_gspro
lm --> utils

core --> encoder
core --> image
core --> output
core --> preview
core --> post

core --> utils
vision --> utils
sim_common --> utils
sim_gspro --> sim_common
sim_gspro --> utils

tests --> core
tests --> vision
tests --> sim_common
tests --> sim_gspro
tests --> utils

tests --> camera_bc : standalone CMake tests
tests --> image_bc : standalone CMake tests

legend right
  |= Color |= Role |
  | <#E5F5FF> | Entrypoint |
  | <#FFE5E5> | Runtime library |
  | <#FFF2E5> | Camera pipeline module |
  | <#FFFFD0> | Simulator integration |
  | <#E5F5E5> | Shared utility |
  | <#F5E5FF> | Bounded context |
  | <#F0F0F0> | Test surface |
endlegend

@enduml
